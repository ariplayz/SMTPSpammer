<?xml version='1.0' encoding='windows-1252'?>
<!--
  WiX v3 installer for smtpspammer.
  Built with cargo-wix (https://github.com/volks73/cargo-wix).
-->
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <?if $(sys.BUILDARCH) = x64 or $(sys.BUILDARCH) = arm64 ?>
    <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
  <?else?>
    <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
  <?endif?>

  <Product
    Id='*'
    Name='smtpspammer'
    UpgradeCode='{66750EFC-EE3E-4CD4-A5C0-F700BF1B58C0}'
    Manufacturer='Ari Cummings'
    Language='1033'
    Codepage='1252'
    Version='$(var.Version)'>

    <Package Id='*'
      Keywords='Installer'
      Description='Bulk email sender via Proton Mail SMTP'
      Manufacturer='Ari Cummings'
      InstallerVersion='450'
      Languages='1033'
      Compressed='yes'
      InstallScope='perMachine'
      SummaryCodepage='1252'
      Platform='$(sys.BUILDARCH)'/>

    <MajorUpgrade
      Schedule='afterInstallInitialize'
      DowngradeErrorMessage='A newer version of [ProductName] is already installed. Setup will now exit.'/>

    <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' DiskPrompt='Disk #1'/>
    <Property Id='DiskPrompt' Value='smtpspammer Installation'/>

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='$(var.PlatformProgramFilesFolder)' Name='PFiles'>
        <Directory Id='APPLICATIONFOLDER' Name='smtpspammer'>

          <Component Id='binary0' Guid='*'>
            <File
              Id='exe0'
              Name='smtpspammer.exe'
              DiskId='1'
              Source='target\$(var.Profile)\smtpspammer.exe'
              KeyPath='yes'/>
          </Component>

          <Component Id='Path' Guid='*' KeyPath='yes'>
            <Environment
              Id='PATH'
              Name='PATH'
              Value='[APPLICATIONFOLDER]'
              Permanent='no'
              Part='last'
              Action='set'
              System='yes'/>
          </Component>

        </Directory>
      </Directory>
    </Directory>

    <Feature
      Id='Binaries'
      Title='Application'
      Description='Installs the smtpspammer executable.'
      Level='1'
      ConfigurableDirectory='APPLICATIONFOLDER'
      AllowAdvertise='no'
      Display='expand'
      Absent='disallow'>

      <ComponentRef Id='binary0'/>

      <Feature
        Id='Environment'
        Title='PATH Environment Variable'
        Description='Add the install location of [ProductName] to the PATH system environment variable. This allows smtpspammer to be called from any location.'
        Level='1'
        Absent='allow'>
        <ComponentRef Id='Path'/>
      </Feature>

    </Feature>

    <SetDirectory Id='APPLICATIONFOLDER' Value='[$(var.PlatformProgramFilesFolder)]smtpspammer'/>

    <UIRef Id='WixUI_FeatureTree'/>
    <UIRef Id='WixUI_ErrorProgressText'/>

  </Product>

</Wix>
